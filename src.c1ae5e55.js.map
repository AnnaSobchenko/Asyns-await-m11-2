{"version":3,"sources":["index.js"],"names":["baseUrl","reqServer","url","method","data","options","headers","responce","body","JSON","stringify","fetch","json","refs","listNode","document","querySelector","form","renderPostList","markup","Promise","all","map","comments","post","id","title","text","like","dislike","author","item","join","innerHTML","addEventListener","e","target","nodeName","closest","dataset","action","Number","textContent","elements","value","confirm","code","shiftKey","postId"],"mappings":";;;AAyGA,aAzGA,QAAA,oBAEA,MAAMA,EAAU,wBAEhB,eAAeC,EAAUC,EAAKC,EAAS,MAAOC,EAAO,IAC7CC,MAAAA,EAAU,CACdF,OAAAA,EACAG,QAAS,CACS,eAAA,oCAQbC,MAJQ,QAAXJ,GAA+B,WAAXA,IACtBE,EAAQG,KAAOC,KAAKC,UAAUN,WAETO,MAAMX,EAAUE,EAAKG,IAC5BO,OAIlB,MAAMC,EAAO,CACXC,SAAUC,SAASC,cAAc,cACjCC,KAAMF,SAASC,cAAc,iBAG/B,eAAeE,IACPd,MAAAA,QAAaH,EAAU,UACvBkB,SACEC,QAAQC,IACZjB,EAAKkB,IAAI,MAAA,IACDC,MAAAA,QAAiBtB,EAAU,oBAAsBuB,EAAKC,IACpD,sBAAeD,EAAKC,qBACtBD,EAAKE,0BACNF,EAAKG,+KAI6BH,EAAKI,oEACEJ,EAAKK,yCACzCL,EAAKM,kHAEQP,EAASD,IAAIS,UAAeA,EAAKJ,aAAaK,KAAK,8BAI9EA,KAAK,IAEPnB,EAAKC,SAASmB,UAAYd,EAG5BD,IACAL,EAAKC,SAASoB,iBAAiB,QAAS,MAAA,IAClCC,GAAsB,SAAtBA,EAAEC,OAAOC,SAAqB,OAC5BZ,MAAAA,EAAKU,EAAEC,OAAOE,QAAQ,MAAMC,QAAQd,GACV,SAA5BU,EAAEC,OAAOG,QAAQC,eACbvC,YAAoBwB,IAAM,QAAS,CAAEG,KAAMa,OAAON,EAAEC,OAAOM,aAAe,IAChFP,EAAEC,OAAOM,YAAcD,OAAON,EAAEC,OAAOM,aAAe,KAI1D7B,EAAKC,SAASoB,iBAAiB,QAAS,MAAA,IAClCC,GAAsB,WAAtBA,EAAEC,OAAOC,SAAuB,OAC9BZ,MAAAA,EAAKU,EAAEC,OAAOE,QAAQ,MAAMC,QAAQd,GACtCU,GAA4B,SAA5BA,EAAEC,OAAOG,QAAQC,OAAmB,CAChCpC,MAAAA,QAAaH,EAAU,UAAYwB,GACzCZ,EAAKI,KAAK0B,SAAShB,KAAKiB,MAAQxC,EAAKuB,KACrCd,EAAKI,KAAK0B,SAASb,OAAOc,MAAQxC,EAAK0B,OACvCjB,EAAKI,KAAK0B,SAASjB,MAAMkB,MAAQxC,EAAKsB,MAGtCb,EAAKI,KAAK0B,SAASlB,GAAGmB,MAAQxC,EAAKqB,GAEL,QAA5BU,EAAEC,OAAOG,QAAQC,QACfK,QAAQ,0BACJ5C,EAAU,UAAYwB,EAAI,UAChCP,OAKNL,EAAKI,KAAKiB,iBAAiB,UAAW,MAAA,IAChCC,GAAW,UAAXA,EAAEW,MAAoBX,EAAEY,SAAU,CACpClC,EAAKI,KAAK0B,SACJvC,MAAAA,EAAO,CACXuB,KAAMd,EAAKI,KAAK0B,SAAShB,KAAKiB,MAC9Bd,OAAQjB,EAAKI,KAAK0B,SAASb,OAAOc,MAClClB,MAAOb,EAAKI,KAAK0B,SAASjB,MAAMkB,OAO5BnB,EAAKZ,EAAKI,KAAK0B,SAASlB,GAAGmB,MAEtB,KAAPnB,GACFrB,EAAKwB,KAAO,EACZxB,EAAKyB,QAAU,QACT5B,EAAU,SAAU,OAAQG,UAE5BH,YAAoBwB,IAAM,QAASrB,MAK/CS,EAAKC,SAASoB,iBAAiB,UAAW,MAAA,IACpCC,GAAW,UAAXA,EAAEW,MAAoBX,EAAEY,UAAkC,UAAtBZ,EAAEC,OAAOC,SAAsB,CAC/DW,MAAAA,EAASP,OAAON,EAAEC,OAAOE,QAAQ,MAAMC,QAAQd,IAC/CE,EAAOQ,EAAEC,OAAOQ,YAChB3C,EAAU,YAAa,OAAQ,CAAE+C,OAAAA,EAAQrB,KAAAA","file":"src.c1ae5e55.js","sourceRoot":"../src","sourcesContent":["import './sass/main.scss';\n\nconst baseUrl = 'http://localhost:3000';\n\nasync function reqServer(url, method = 'GET', data = {}) {\n  const options = {\n    method,\n    headers: {\n      'Content-Type': 'application/json; charset=UTF-8',\n    },\n  };\n\n  if (method !== 'GET' && method !== 'DELETE') {\n    options.body = JSON.stringify(data);\n  }\n  const responce = await fetch(baseUrl + url, options);\n  return responce.json();\n}\n// reqServer('/posts').then(data => console.log(data));\n\nconst refs = {\n  listNode: document.querySelector('.post-list'),\n  form: document.querySelector('#create-post'),\n};\n\nasync function renderPostList() {\n  const data = await reqServer('/posts');\n  const markup = (\n    await Promise.all(\n      data.map(async post => {\n        const comments = await reqServer('/comments?postId=' + post.id);\n        return `<li data-id=\"${post.id}\">\n        <h3>${post.title}</h3>\n        <p>${post.text}</p>\n        <button data-action=\"del\">DELETE</button> \n        <button data-action=\"edit\">EDIT</button>\n        <div>\n        <span class=\"like\" data-actio=\"like\">${post.like}</span>\n        <span class=\"dislike\" data-action=\"dislike\">${post.dislike}</span></div>\n        <small> ${post.author}</small></p>\n        <input class='create-comment' placeholder=\"Comment\">\n        <ul class=\"comments\">${comments.map(item => `<li>${item.text}</li>`).join('')}</ul>\n        </li>`;\n      }),\n    )\n  ).join('');\n\n  refs.listNode.innerHTML = markup;\n}\n\nrenderPostList();\nrefs.listNode.addEventListener('click', async e => {\n  if (e.target.nodeName !== 'SPAN') return;\n  const id = e.target.closest('li').dataset.id;\n  if (e.target.dataset.action === 'like') {\n    await reqServer(`/posts/${id}`, 'PATCH', { like: Number(e.target.textContent) + 1 });\n    e.target.textContent = Number(e.target.textContent) + 1;\n  }\n});\n\nrefs.listNode.addEventListener('click', async e => {\n  if (e.target.nodeName !== 'BUTTON') return;\n  const id = e.target.closest('li').dataset.id;\n  if (e.target.dataset.action === 'edit') {\n    const data = await reqServer('/posts/' + id);\n    refs.form.elements.text.value = data.text;\n    refs.form.elements.author.value = data.author;\n    refs.form.elements.title.value = data.title;\n    // refs.form.elements.title.value = data.like;\n    // refs.form.elements.title.value = data.dilike;\n    refs.form.elements.id.value = data.id;\n  }\n  if (e.target.dataset.action === 'del') {\n    if (confirm('Are your sure?')) {\n      await reqServer('/posts/' + id, 'DELETE');\n      renderPostList();\n    }\n  }\n});\n\nrefs.form.addEventListener('keydown', async e => {\n  if (e.code === 'Enter' && e.shiftKey) {\n    refs.form.elements;\n    const data = {\n      text: refs.form.elements.text.value,\n      author: refs.form.elements.author.value,\n      title: refs.form.elements.title.value,\n    };\n    const updateForm = data => {\n      refs.form.reset();\n      refs.form.elements.id.value = '';\n      renderPostList();\n    };\n    const id = refs.form.elements.id.value;\n\n    if (id === '') {\n      data.like = 0;\n      data.dislike = 0;\n      await reqServer('/posts', 'POST', data);\n    } else {\n      await reqServer(`/posts/${id}`, 'PATCH', data);\n    }\n  }\n});\n\nrefs.listNode.addEventListener('keydown', async e => {\n  if (e.code === 'Enter' && e.shiftKey && e.target.nodeName === 'INPUT') {\n    const postId = Number(e.target.closest('li').dataset.id);\n    const text = e.target.value;\n    await reqServer('/comments', 'POST', { postId, text });\n  }\n  // renderPostList();\n});\n"]}